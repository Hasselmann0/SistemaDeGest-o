<h2 mat-dialog-title>
  <mat-icon class="title-icon">history</mat-icon>
  Histórico — {{ data.title }}
</h2>

<mat-dialog-content>
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="36"></mat-spinner>
    </div>
  } @else if (error()) {
    <p class="error-text">{{ error() }}</p>
  } @else if (history().length === 0) {
    <p class="empty-text">Nenhum histórico de alteração encontrado.</p>
  } @else {
    <div class="timeline">
      @for (item of history(); track item.id) {
        <div class="timeline-item">
          <div class="timeline-dot" [attr.data-status]="item.toStatus"></div>
          <div class="timeline-content">
            <div class="timeline-header">
              <span class="status-from">{{ statusLabel(item.fromStatus) }}</span>
              <mat-icon class="arrow-icon">arrow_forward</mat-icon>
              <span class="status-to" [attr.data-status]="item.toStatus">{{ statusLabel(item.toStatus) }}</span>
            </div>
            <div class="timeline-meta">
              <span class="timeline-user">
                <mat-icon class="meta-icon">person</mat-icon>
                {{ item.changedByUserName }}
              </span>
              <span class="timeline-date">
                <mat-icon class="meta-icon">schedule</mat-icon>
                {{ item.changedAt | date: 'dd/MM/yyyy HH:mm' }}
              </span>
            </div>
            @if (item.comment) {
              <div class="timeline-comment">
                <mat-icon class="meta-icon">comment</mat-icon>
                {{ item.comment }}
              </div>
            }
          </div>
        </div>
      }
    </div>
  }
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="close()">Fechar</button>
</mat-dialog-actions>
